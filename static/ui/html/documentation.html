<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Documentation Dashboard</title>
    
    <!-- External CSS Files -->
    <link rel="stylesheet" href="/ui/css/common.css">
    <link rel="stylesheet" href="/ui/css/documentation.css">
    
    <!-- External Libraries -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/PapaParse/5.4.1/papaparse.min.js"></script>
</head>
<body>
    <div class="container">
        <!-- Header -->
        <div class="header">
            <div class="header-content">
                <div class="header-left">
                    <div>
                        <h1 class="header-title">Documentation Dashboard</h1>
                        <p class="header-subtitle">Professional quality document generation with banking compliance</p>
                    </div>
                </div>
                <div class="stats-grid">
                    <div class="stat-card">
                        <div class="stat-value" style="color: var(--accent-blue);" id="totalDocuments">0</div>
                        <div class="stat-label">Total Documents</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-value" style="color: var(--accent-green);" id="generatedDocs">0</div>
                        <div class="stat-label">Generated</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-value" style="color: var(--accent-orange);" id="inProgressDocs">0</div>
                        <div class="stat-label">In Progress</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-value" style="color: var(--accent-purple);" id="qualityScore">0%</div>
                        <div class="stat-label">Quality Score</div>
                    </div>
                </div>
            </div>
            <button class="theme-toggle" onclick="toggleTheme()">🌙</button>
        </div>

        <!-- Navigation Tabs -->
        <div class="nav-tabs">
            <a href="../../index.html" class="tab-btn">
                <span class="tab-icon">📂️</span>
                <span>Topology</span>
            </a>
            <a href="#" class="tab-btn disabled">
                <span class="tab-icon">📄</span>
                <span>Convergence</span>
            </a>
            <a href="/ui/html/archetype.html" class="tab-btn">
                <span class="tab-icon">🗃️</span>
                <span>Archetype Classification</span>
            </a>
            <a href="/ui/html/integration.html" class="tab-btn">
                <span class="tab-icon">🔗</span>
                <span>Integration</span>
            </a>
            <a href="/ui/html/model.html" class="tab-btn">
                <span class="tab-icon">📊</span>
                <span>Model</span>
            </a>
            <a href="/ui/html/documentation.html" class="tab-btn active">
                <span class="tab-icon">📚</span>
                <span>Documentation</span>
            </a>
            <a href="/ui/html/appRationalization.html" class="tab-btn">
                <span class="tab-icon">7️⃣</span>
                <span>App Rationalization</span>
            </a>
            <a href="/ui/html/recommendations.html" class="tab-btn">
                <span class="tab-icon">💡</span>
                <span>Recommendations</span>
            </a>
        </div>

        <!-- Documentation Main Content -->
        <div class="main-grid">
            <!-- Left Panel - Document Generator Controls -->
            <div class="panel">
                <div class="panel-title">📝 Enhanced Document Generator</div>
                
                <!-- File Upload Section -->
                <div class="metric-section">
                    <div class="filter-title">
                        <span>📁</span>
                        <span>Data Source</span>
                    </div>
                    <div class="file-upload-area" onclick="document.getElementById('fileInput').click()">
                        <div style="font-size: 2rem; margin-bottom: 10px; color: var(--accent-blue);">📤</div>
                        <div>Drop files here or click to browse</div>
                        <div style="font-size: 0.8rem; color: var(--text-muted); margin-top: 5px;">
                            Supports: CSV, XLSX, JSON
                        </div>
                    </div>
                    <input type="file" id="fileInput" style="display: none;" accept=".csv,.xlsx,.json" multiple>
                    
                    <select class="form-select" id="dataSource" style="margin-top: 10px;">
                        <option value="data_staging">📂 data_staging/ folder</option>
                        <option value="upload">📤 Upload new file</option>
                        <option value="single_app">🎯 Single application</option>
                    </select>
                </div>
                
                <!-- Quality Level Section -->
                <div class="metric-section">
                    <div class="filter-title">
                        <span>🎯</span>
                        <span>Quality Level</span>
                    </div>
                    <select class="form-select" id="qualityLevel">
                        <option value="professional">Professional Grade (95%+)</option>
                        <option value="executive">Executive Grade (98%+)</option>
                        <option value="technical">Technical Grade (90%+)</option>
                    </select>
                    <div style="font-size: 0.8rem; color: var(--text-muted); margin-top: 5px;" id="qualityDescription">
                        Professional quality for business stakeholders
                    </div>
                </div>
                
                <!-- Output Format Section -->
                <div class="metric-section">
                    <div class="filter-title">
                        <span>📊</span>
                        <span>Output Formats</span>
                    </div>
                    <select class="form-select" id="outputFormat" style="margin-bottom: 15px;">
                        <option value="all">🚀 All Formats (Complete Package)</option>
                        <option value="both">📊 Visio + Lucid Charts</option>
                        <option value="visio">📊 Visio XML Only</option>
                        <option value="lucid">📊 Lucid Chart Only</option>
                    </select>
                    <div class="format-options">
                        <label class="checkbox-label">
                            <input type="checkbox" id="includeWord" checked>
                            <span>📄 Word Templates</span>
                        </label>
                        <label class="checkbox-label">
                            <input type="checkbox" id="includeExcel" checked>
                            <span>📊 Excel Mappers</span>
                        </label>
                        <label class="checkbox-label">
                            <input type="checkbox" id="includePDF" checked>
                            <span>📑 PDF Reports</span>
                        </label>
                    </div>
                </div>
                
                <!-- Application Filter -->
                <div class="metric-section">
                    <div class="filter-title">
                        <span>📋</span>
                        <span>Application Filter</span>
                    </div>
                    <select class="form-select" id="applicationSelect" multiple size="6">
                        <option value="CORE_BANKING">Core Banking System (CORE_BANKING)</option>
                        <option value="CUSTOMER_PORTAL">Customer Portal (CUSTOMER_PORTAL)</option>
                        <option value="PAYMENT_GATEWAY">Payment Gateway (PAYMENT_GATEWAY)</option>
                        <option value="RISK_ENGINE">Risk Engine (RISK_ENGINE)</option>
                        <option value="ANALYTICS_PLATFORM">Analytics Platform (ANALYTICS_PLATFORM)</option>
                    </select>
                    <input type="text" class="form-input" id="filterInput" 
                           placeholder="Search applications..." style="margin-top: 10px;">
                    <div class="filter-controls">
                        <button class="btn btn-sm" onclick="selectAll()">All</button>
                        <button class="btn btn-sm" onclick="clearSelection()">Clear</button>
                        <button class="btn btn-sm" onclick="resetFilter()">Reset</button>
                    </div>
                    <div class="selection-info">
                        <small id="selectionCount">0 applications selected</small>
                    </div>
                </div>
                
                <!-- Processing Mode -->
                <div class="metric-section">
                    <div class="filter-title">
                        <span>⚙️</span>
                        <span>Processing Mode</span>
                    </div>
                    <select class="form-select" id="processingMode" style="margin-bottom: 15px;">
                        <option value="documentation">📄 Documentation</option>
                        <option value="topology">🔗 Network Topology</option>
                        <option value="diagram">📊 Diagrams</option>
                        <option value="all">🚀 Complete Analysis</option>
                    </select>
                    <button class="btn btn-primary" onclick="processApplications()" style="width: 100%;">
                        🚀 Generate Enhanced Documents
                    </button>
                </div>
            </div>

            <!-- Middle Panel - Document Viewer -->
            <div class="documentation-container">
                <div class="documentation-header">
                    <div class="panel-title">📚 Document Viewer & Generator</div>
                    <div class="view-controls">
                        <button class="btn active" onclick="setDocumentationView('generator')" id="generatorBtn">Generator</button>
                        <button class="btn" onclick="setDocumentationView('preview')" id="previewBtn">Preview</button>
                        <button class="btn" onclick="setDocumentationView('templates')" id="templatesBtn">Templates</button>
                    </div>
                    <div class="paper-size-controls">
                        <select class="btn-select" id="paperSize" onchange="changePaperSize()">
                            <option value="a4">📄 A4 (210×297mm)</option>
                            <option value="letter">📄 Letter (8.5×11")</option>
                            <option value="legal">📄 Legal (8.5×14")</option>
                            <option value="tabloid" selected>📊 Tabloid (11×17")</option>
                            <option value="a3">📊 A3 (297×420mm)</option>
                        </select>
                        <div class="zoom-controls">
                            <button class="btn btn-sm" onclick="zoomOut()">🔍−</button>
                            <span id="zoomLevel">100%</span>
                            <button class="btn btn-sm" onclick="zoomIn()">🔍+</button>
                            <button class="btn btn-sm" onclick="fitToWindow()">⟷ Fit</button>
                        </div>
                    </div>
                </div>
                
                <div class="document-viewer-area" id="documentationCanvas">
                    <div class="viewer-workspace">
                        <!-- Document Paper -->
                        <div class="document-paper tabloid" id="documentPaper">
                            <div class="paper-content">
                                <!-- Generator View -->
                                <div class="view-content" id="generatorView">
                                    <div class="canvas-placeholder">
                                        <div class="icon">📊</div>
                                        <h3>Document Generator</h3>
                                        <p>Generate professional diagrams and documents</p>
                                        <div class="feature-highlight">
                                            <h4 style="color: var(--accent-blue); margin-bottom: 15px;">🎯 Enhanced Features</h4>
                                            <div class="feature-grid">
                                                <div>• <strong>Quality Levels:</strong> Executive (98%+), Professional (95%+)</div>
                                                <div>• <strong>Multiple Formats:</strong> Visio, Word, Excel, PDF</div>
                                                <div>• <strong>Banking Compliance:</strong> PCI-DSS, SOX, FFIEC</div>
                                                <div>• <strong>Professional Layouts:</strong> Golden ratio spacing</div>
                                                <div>• <strong>Real-time Preview:</strong> See results instantly</div>
                                                <div>• <strong>Enterprise Ready:</strong> Corporate branding</div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                                
                                <!-- Preview View -->
                                <div class="view-content" id="previewView" style="display: none;">
                                    <div class="canvas-placeholder">
                                        <div class="icon">👁️</div>
                                        <h3>Document Preview</h3>
                                        <p>Preview generated documents and diagrams</p>
                                        <div class="preview-area">
                                            <div class="preview-placeholder">
                                                <div style="border: 2px dashed var(--border-color); padding: 40px; border-radius: 8px; background: rgba(59, 130, 246, 0.05);">
                                                    <div style="color: var(--accent-blue); font-size: 2rem; margin-bottom: 10px;">📋</div>
                                                    <div>Document preview will appear here</div>
                                                    <div style="font-size: 0.8rem; color: var(--text-muted); margin-top: 8px;">
                                                        Supports: Visio, Excel, Word, PDF viewing
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                                
                                <!-- Templates View -->
                                <div class="view-content" id="templatesView" style="display: none;">
                                    <div class="canvas-placeholder">
                                        <div class="icon">🗂️</div>
                                        <h3>Document Templates</h3>
                                        <p>Choose from professional templates</p>
                                        <div class="templates-grid">
                                            <div class="template-card" onclick="selectTemplate('network-topology')">
                                                <div class="template-icon">🌐</div>
                                                <div class="template-name">Network Topology</div>
                                                <div class="template-desc">Infrastructure diagrams</div>
                                            </div>
                                            <div class="template-card" onclick="selectTemplate('data-flow')">
                                                <div class="template-icon">📊</div>
                                                <div class="template-name">Data Flow</div>
                                                <div class="template-desc">Process diagrams</div>
                                            </div>
                                            <div class="template-card" onclick="selectTemplate('architecture')">
                                                <div class="template-icon">🗃️</div>
                                                <div class="template-name">Architecture</div>
                                                <div class="template-desc">System architecture</div>
                                            </div>
                                            <div class="template-card" onclick="selectTemplate('executive-summary')">
                                                <div class="template-icon">📈</div>
                                                <div class="template-name">Executive Summary</div>
                                                <div class="template-desc">Business reports</div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                
                <div class="documentation-details" id="documentationDetails" style="display: none;">
                    <div class="detail-title" id="detailTitle">Document Generation Status</div>
                    <div class="detail-info"><strong>Status:</strong> <span id="detailStatus">Ready</span></div>
                    <div class="detail-info"><strong>Quality Level:</strong> <span id="detailQuality">Professional (95%+)</span></div>
                    <div class="detail-info"><strong>Output Format:</strong> <span id="detailFormat">All Formats</span></div>
                    <div class="detail-info"><strong>Progress:</strong> <span id="detailProgress">0%</span></div>
                    
                    <div class="progress-list">
                        <div style="font-size: 11px; font-weight: 600; margin-bottom: 6px; color: var(--text-muted);">Generation Steps:</div>
                        <div id="detailSteps"></div>
                    </div>
                </div>
            </div>

            <!-- Right Panel - Status and Results -->
            <div class="panel status-panel">
                <div class="panel-title">📊 Generation Status</div>
                
                <!-- Batch Info -->
                <div class="status-section">
                    <div class="filter-title">
                        <span>📦</span>
                        <span>Batch Information</span>
                    </div>
                    <div class="batch-info">
                        <div class="stat-row">
                            <span>Total Apps:</span>
                            <span id="totalApps">51</span>
                        </div>
                        <div class="stat-row">
                            <span>Selected:</span>
                            <span id="selectedApps">5</span>
                        </div>
                        <div class="stat-row">
                            <span>Current Batch:</span>
                            <span id="currentBatch">1</span>
                        </div>
                        <div class="stat-row">
                            <span>Batch Size:</span>
                            <span id="batchSize">50</span>
                        </div>
                        <div class="stat-row">
                            <span>Range:</span>
                            <span id="batchRange">1-50</span>
                        </div>
                        <div class="stat-row">
                            <span>Total:</span>
                            <span id="batchTotal">51</span>
                        </div>
                    </div>
                    <div class="batch-controls">
                        <button class="btn btn-sm" onclick="previousBatch()" id="prevBtn">← Previous</button>
                        <button class="btn btn-sm" onclick="nextBatch()" id="nextBtn">Next →</button>
                    </div>
                </div>

                <!-- Processing Status -->
                <div class="status-section">
                    <div class="filter-title">
                        <span>⚡</span>
                        <span>Processing Status</span>
                    </div>
                    <div class="processing-panel" id="processingPanel">
                        <div>Ready for Enhanced Generation</div>
                        <div style="font-size: 0.8rem; color: var(--text-muted); margin-top: 5px;">
                            Select applications, quality level, and formats
                        </div>
                    </div>
                </div>

                <!-- Quick Generation Buttons -->
                <div class="status-section">
                    <div class="filter-title">
                        <span>🔧</span>
                        <span>Quick Generate</span>
                    </div>
                    <div class="quick-buttons">
                        <button class="btn btn-sm" onclick="generateVisio()">📊 Visio</button>
                        <button class="btn btn-sm" onclick="generateLucid()">📊 Lucid</button>
                        <button class="btn btn-sm" onclick="generatePDF()">📑 PDF</button>
                        <button class="btn btn-sm" onclick="generateWord()">📄 Word</button>
                        <button class="btn btn-sm" onclick="generateExcel()">📊 Excel</button>
                        <button class="btn btn-sm" onclick="downloadJSON()">📥 JSON</button>
                    </div>
                </div>

                <!-- Results -->
                <div class="status-section">
                    <div class="filter-title">
                        <span>✅</span>
                        <span>Generated Documents</span>
                    </div>
                    <div class="result-panel" id="resultPanel" style="display: none;">
                        <div id="jsonPreview"></div>
                    </div>
                    <div id="noResults" style="color: var(--text-muted); font-size: 0.8rem; text-align: center; padding: 15px;">
                        No documents generated yet
                    </div>
                </div>

                <!-- Application List -->
                <div class="status-section">
                    <div class="filter-title">
                        <span>📋</span>
                        <span>Applications</span>
                    </div>
                    <div id="appList">
                        <div class="app-item" onclick="toggleAppSelection('CORE_BANKING')">
                            <div>
                                <div class="app-name">Core Banking System</div>
                                <div class="app-id">CORE_BANKING</div>
                            </div>
                        </div>
                        <div class="app-item" onclick="toggleAppSelection('CUSTOMER_PORTAL')">
                            <div>
                                <div class="app-name">Customer Portal</div>
                                <div class="app-id">CUSTOMER_PORTAL</div>
                            </div>
                        </div>
                        <div class="app-item" onclick="toggleAppSelection('PAYMENT_GATEWAY')">
                            <div>
                                <div class="app-name">Payment Gateway</div>
                                <div class="app-id">PAYMENT_GATEWAY</div>
                            </div>
                        </div>
                        <div class="app-item" onclick="toggleAppSelection('RISK_ENGINE')">
                            <div>
                                <div class="app-name">Risk Engine</div>
                                <div class="app-id">RISK_ENGINE</div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Status Bar -->
    <div id="statusBar" class="status-bar">
        <!-- Left side status items -->
        <div class="status-left">
            <div class="status-item">
                <div class="status-indicator" id="connectionIndicator"></div>
                <span id="connectionStatus">🔄 Connecting...</span>
            </div>
            <div class="status-item">
                <span id="lastUpdate">Last updated: Loading...</span>
            </div>
            <div class="status-item">
                <span id="documentCount">Documents: 0</span>
            </div>
        </div>

        <!-- Right side status items -->
        <div class="status-right">
            <div class="status-item">
                <span id="systemStatus">System: Ready</span>
            </div>
            <div class="status-item">
                <span id="userInfo">User: Admin</span>
            </div>
            <div class="status-item">
                <span id="version">v2.0.0</span>
            </div>
        </div>
    </div>

    <!-- Load JavaScript Files -->
    <script src="/ui/js/app-data.js"></script>
    <script src="/ui/js/common.js"></script>
    <script src="/ui/js/documentation.js"></script>
    <script src="/ui/js/shared-state.js"></script>
    
    <!-- Page-specific JavaScript -->
    <script>
        console.log('📊 Documentation Dashboard Loading...');

        // Global variables

        window.currentZoom = window.currentZoom || 100;
		window.currentPaperSize = window.currentPaperSize || 'tabloid';
        window.selectedApps = window.selectedApps || new Set();
        window.applications = window.applications || [
			{ id: 'CORE_BANKING', name: 'Core Banking System' },
			{ id: 'CUSTOMER_PORTAL', name: 'Customer Portal' },
			{ id: 'PAYMENT_GATEWAY', name: 'Payment Gateway' },
			{ id: 'RISK_ENGINE', name: 'Risk Engine' },
			{ id: 'ANALYTICS_PLATFORM', name: 'Analytics Platform' }
		];

        // Theme Management
        function toggleTheme() {
            const currentTheme = document.documentElement.getAttribute('data-theme') || 'dark';
            const newTheme = currentTheme === 'dark' ? 'light' : 'dark';
            setTheme(newTheme);
        }

        function setTheme(theme) {
            document.documentElement.setAttribute('data-theme', theme);
            localStorage.setItem('dashboard-theme', theme);
            
            const themeToggle = document.querySelector('.theme-toggle');
            if (themeToggle) {
                themeToggle.innerHTML = theme === 'dark' ? '☀️' : '🌙';
            }
            
            console.log(`🎨 Theme changed to: ${theme}`);
        }

        // Paper size management
        function changePaperSize() {
            const paperSelect = document.getElementById('paperSize');
            const paperElement = document.getElementById('documentPaper');
            
            if (paperSelect && paperElement) {
                // Remove old size classes
                paperElement.classList.remove('a4', 'letter', 'legal', 'tabloid', 'a3');
                
                // Add new size class
                currentPaperSize = paperSelect.value;
                paperElement.classList.add(currentPaperSize);
                
                console.log(`📄 Paper size changed to: ${currentPaperSize}`);
                
                // Auto-fit to window after size change
                setTimeout(fitToWindow, 100);
            }
        }

        // Zoom controls
        function zoomIn() {
            if (currentZoom < 200) {
                currentZoom += 25;
                updateZoom();
            }
        }

        function zoomOut() {
            if (currentZoom > 50) {
                currentZoom -= 25;
                updateZoom();
            }
        }

        function updateZoom() {
            const workspace = document.querySelector('.viewer-workspace');
            const zoomDisplay = document.getElementById('zoomLevel');
            
            if (workspace && zoomDisplay) {
                workspace.style.transform = `scale(${currentZoom / 100})`;
                zoomDisplay.textContent = `${currentZoom}%`;
            }
        }

        function fitToWindow() {
            const container = document.querySelector('.document-viewer-area');
            const paper = document.getElementById('documentPaper');
            const workspace = document.querySelector('.viewer-workspace');
            
            if (!container || !paper || !workspace) return;
            
            const containerRect = container.getBoundingClientRect();
            
            const scaleX = (containerRect.width - 80) / paper.offsetWidth;
            const scaleY = (containerRect.height - 80) / paper.offsetHeight;
            const scale = Math.min(scaleX, scaleY, 1);
            
            currentZoom = Math.round(scale * 100);
            workspace.style.transform = `scale(${scale})`;
            
            const zoomDisplay = document.getElementById('zoomLevel');
            if (zoomDisplay) {
                zoomDisplay.textContent = `${currentZoom}%`;
            }
        }

        // Template selection
        function selectTemplate(templateId) {
            console.log(`🗂️ Template selected: ${templateId}`);
            
            setDocumentationView('generator');
            
            showToast(`Template "${templateId}" selected! Ready for document generation.`, 'success');
        }

        // Application filtering and selection
        function filterApplications() {
            const filterInput = document.getElementById('filterInput');
            const dropdown = document.getElementById('applicationSelect');
            const appList = document.getElementById('appList');
            
            if (!filterInput) return;
            
            const query = filterInput.value.toLowerCase();
            
            // Filter dropdown options
            if (dropdown) {
                Array.from(dropdown.options).forEach(option => {
                    const text = option.textContent.toLowerCase();
                    const matches = text.includes(query);
                    option.style.display = matches ? '' : 'none';
                });
            }
            
            // Filter visual app list
            if (appList) {
                const appItems = appList.querySelectorAll('.app-item');
                appItems.forEach(item => {
                    const appName = item.querySelector('.app-name')?.textContent.toLowerCase() || '';
                    const appId = item.querySelector('.app-id')?.textContent.toLowerCase() || '';
                    const matches = appName.includes(query) || appId.includes(query);
                    item.style.display = matches ? 'flex' : 'none';
                });
            }
            
            console.log(`Filtered applications with query: "${query}"`);
        }

        function toggleAppSelection(appId) {
            const appItem = document.querySelector(`[onclick="toggleAppSelection('${appId}')"]`);
            
            if (selectedApps.has(appId)) {
                selectedApps.delete(appId);
                appItem.classList.remove('selected');
            } else {
                selectedApps.add(appId);
                appItem.classList.add('selected');
            }
            
            updateSelectionCount();
            updateStats();
        }

        function selectAll() {
            const dropdown = document.getElementById('applicationSelect');
            if (dropdown) {
                Array.from(dropdown.options).forEach(option => {
                    option.selected = true;
                    selectedApps.add(option.value);
                });
            }
            
            // Also select in visual list
            document.querySelectorAll('.app-item').forEach(item => {
                item.classList.add('selected');
            });
            
            updateSelectionCount();
        }

        function clearSelection() {
            const dropdown = document.getElementById('applicationSelect');
            if (dropdown) {
                Array.from(dropdown.options).forEach(option => {
                    option.selected = false;
                });
            }
            
            selectedApps.clear();
            
            document.querySelectorAll('.app-item').forEach(item => {
                item.classList.remove('selected');
            });
            
            updateSelectionCount();
        }

        function resetFilter() {
            const filterInput = document.getElementById('filterInput');
            const dropdown = document.getElementById('applicationSelect');
            const appList = document.getElementById('appList');
            
            // Clear filter input
            if (filterInput) {
                filterInput.value = '';
            }
            
            // Show all dropdown options
            if (dropdown) {
                Array.from(dropdown.options).forEach(option => {
                    option.style.display = '';
                });
            }
            
            // Show all app items
            if (appList) {
                const appItems = appList.querySelectorAll('.app-item');
                appItems.forEach(item => {
                    item.style.display = 'flex';
                });
            }
            
            console.log('Application filter reset');
        }

        function updateSelectionCount() {
            const counter = document.getElementById('selectionCount');
            if (counter) {
                counter.textContent = `${selectedApps.size} applications selected`;
            }
        }

        function updateStats() {
            const selectedAppsElement = document.getElementById('selectedApps');
            if (selectedAppsElement) {
                selectedAppsElement.textContent = selectedApps.size;
            }
        }

        // Processing
        async function processApplications() {
            if (selectedApps.size === 0) {
                showToast('Please select at least one application to process.', 'warning');
                return;
            }
            
            const panel = document.getElementById('processingPanel');
			if (panel) {
				panel.classList.add('active');
				panel.innerHTML = `
					<div>🚀 Processing ${selectedApps.size} Applications</div>
					<div style="font-size: 0.8rem; color: var(--text-muted); margin-top: 5px;">
						Calling FastAPI backend...
					</div>
					<div class="progress-bar" style="margin-top: 10px;">
						<div class="progress-fill documentation" id="progressFill"></div>
					</div>
				`;
			}
            
            try {
				// Get the first selected app for testing
				const firstApp = Array.from(selectedApps)[0];
				const qualityLevel = document.getElementById('qualityLevel').value;
				
				// Call your working FastAPI endpoint
				const response = await fetch(`http://localhost:8001/api/v1/archetype/generate-practical-diagrams?archetype=three_tier&app_name=${firstApp}`, {
					method: 'GET',
					headers: {
						'Accept': 'application/json',
					}
				});
				
				if (!response.ok) {
					throw new Error(`API returned ${response.status}: ${response.statusText}`);
				}
				
				const result = await response.json();
				console.log('Real API Response:', result);
				
				// Show real results
				const resultPanel = document.getElementById('resultPanel');
				const noResults = document.getElementById('noResults');
				
				if (resultPanel && noResults) {
					noResults.style.display = 'none';
					resultPanel.style.display = 'block';
					
					const preview = document.getElementById('jsonPreview');
					if (preview) {
						preview.textContent = JSON.stringify(result, null, 2);
					}
				}
				
				// Update panel with success
				if (panel) {
					panel.innerHTML = `
						<div>✅ Real Processing Complete!</div>
						<div style="font-size: 0.8rem; color: var(--accent-green); margin-top: 5px;">
							Generated via FastAPI backend
						</div>
					`;
				}
				
				showToast('Real documents generated! Check results folder.', 'success');
				
			} catch (error) {
				console.error('Real API Error:', error);
				
				if (panel) {
					panel.innerHTML = `
						<div>❌ API Error</div>
						<div style="font-size: 0.8rem; color: var(--accent-red); margin-top: 5px;">
							${error.message}
						</div>
					`;
				}
				
				showToast(`API Error: ${error.message}`, 'error');
			}
		}

        function completeProcessing() {
            const panel = document.getElementById('processingPanel');
            if (panel) {
                panel.classList.add('success');
                panel.innerHTML = `
                    <div>✅ Processing Complete!</div>
                    <div style="font-size: 0.8rem; color: var(--accent-green); margin-top: 5px;">
                        ${selectedApps.size} documents generated successfully
                    </div>
                `;
            }
            
            // Show results
            const resultPanel = document.getElementById('resultPanel');
            const noResults = document.getElementById('noResults');
            
            if (resultPanel && noResults) {
                noResults.style.display = 'none';
                resultPanel.style.display = 'block';
                
                const preview = document.getElementById('jsonPreview');
                if (preview) {
                    preview.textContent = JSON.stringify({
                        success: true,
                        documents: selectedApps.size,
                        formats: ['visio', 'pdf', 'word', 'excel'],
                        timestamp: new Date().toISOString()
                    }, null, 2);
                }
            }
            
            showToast(`Successfully generated ${selectedApps.size} enhanced documents!`, 'success');
        }

        // Quick generation functions
        function generateVisio() { quickGenerate('Visio XML', '📊'); }
        function generateLucid() { quickGenerate('Lucid Charts', '📊'); }
        function generatePDF() { quickGenerate('PDF Report', '📑'); }
        function generateWord() { quickGenerate('Word Document', '📄'); }
        function generateExcel() { quickGenerate('Excel Mapper', '📊'); }
        
        function downloadJSON() { 
            const data = {
                applications: Array.from(selectedApps),
                timestamp: new Date().toISOString(),
                settings: {
                    quality: document.getElementById('qualityLevel').value,
                    format: document.getElementById('outputFormat').value
                }
            };
            
            const dataStr = JSON.stringify(data, null, 2);
            const dataBlob = new Blob([dataStr], {type: 'application/json'});
            const url = URL.createObjectURL(dataBlob);
            
            const link = document.createElement('a');
            link.href = url;
            link.download = `documentation_config_${new Date().toISOString().split('T')[0]}.json`;
            link.click();
            
            URL.revokeObjectURL(url);
            showToast('JSON configuration downloaded!', 'success');
        }

        function quickGenerate(type, icon) {
            if (selectedApps.size === 0) {
                showToast('Please select applications first.', 'warning');
                return;
            }
            
            showToast(`${icon} Generating ${type}...`, 'info');
            
            setTimeout(() => {
                showToast(`${icon} ${type} generated successfully!`, 'success');
            }, 2000);
        }

        // Batch navigation
        function previousBatch() {
            console.log('📦 Previous batch');
        }

        function nextBatch() {
            console.log('📦 Next batch');
        }

        // Toast notification system
        function showToast(message, type = 'info') {
            let toastContainer = document.getElementById('toast-container');
            if (!toastContainer) {
                toastContainer = document.createElement('div');
                toastContainer.id = 'toast-container';
                toastContainer.style.cssText = `
                    position: fixed;
                    top: 80px;
                    right: 20px;
                    z-index: 9999;
                    display: flex;
                    flex-direction: column;
                    align-items: flex-end;
                    gap: 10px;
                `;
                document.body.appendChild(toastContainer);
            }
            
            const toast = document.createElement('div');
            toast.className = `toast ${type}`;
            toast.textContent = message;
            
            toastContainer.appendChild(toast);
            
            setTimeout(() => {
                toast.remove();
            }, 4000);
        }

        // Initialize on DOM ready
        document.addEventListener('DOMContentLoaded', function() {
            const urlParams = new URLSearchParams(window.location.search);
            const jobId = urlParams.get('job_id');
            
            if (jobId) {
                console.log('📊 Loading job context:', jobId);
                // Load job-specific data here
            }
            
            // Set theme on load
            const savedTheme = localStorage.getItem('dashboard-theme') || 'dark';
            setTheme(savedTheme);
            
            // Set default paper size
            changePaperSize();
            
            // Fit to window initially
            setTimeout(fitToWindow, 500);
            
            // Handle window resize
            window.addEventListener('resize', fitToWindow);
            
            // Filter input handler
            const filterInput = document.getElementById('filterInput');
            if (filterInput) {
                filterInput.addEventListener('input', filterApplications);
            }
            
            // File input handler
            const fileInput = document.getElementById('fileInput');
            if (fileInput) {
                fileInput.addEventListener('change', function(e) {
                    if (e.target.files.length > 0) {
                        const fileNames = Array.from(e.target.files).map(f => f.name).join(', ');
                        showToast(`📁 Files uploaded: ${fileNames}`, 'success');
                    }
                });
            }
            
            // Quality level change handler
            const qualitySelect = document.getElementById('qualityLevel');
            if (qualitySelect) {
                qualitySelect.addEventListener('change', function() {
                    const descriptions = {
                        'professional': 'Template-driven professional diagrams with proper styling',
                        'executive': '98%+ quality with banking-style PDFs using Playwright conversion',
                        'technical': '90%+ quality with detailed annotations and technical layouts'
                    };
                    
                    const desc = document.getElementById('qualityDescription');
                    if (desc) {
                        desc.textContent = descriptions[this.value] || 'Professional quality documentation';
                    }
                });
            }
            
            // Application select handler
            const appSelect = document.getElementById('applicationSelect');
            if (appSelect) {
                appSelect.addEventListener('change', function() {
                    selectedApps.clear();
                    Array.from(this.selectedOptions).forEach(option => {
                        if (option.value) {
                            selectedApps.add(option.value);
                        }
                    });
                    updateSelectionCount();
                    updateStats();
                });
            }
            
            console.log('📊 Documentation Dashboard Ready');
            showToast('Documentation Dashboard loaded successfully!', 'success');
        });

        console.log('📊 Documentation Dashboard Script Loaded Successfully');
    </script>
</body>
</html>